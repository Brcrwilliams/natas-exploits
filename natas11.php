<?php
/*
19 July 2017
The application uses a cookie which is an XOR encrytped JSON array.
The encryption key is secret, but since we know both the plaintext and the ciphertext,
we can XOR them together in order to find the secret key and forge ourselves a cookie that shows the password.
*/
$ciphertext = base64_decode('ClVLIh4ASCsCBE8lAxMacFMZV2hdVVotEhhUJQNVAmhSEV4sFxFeaAw=');
$plaintext = json_encode(array( "showpassword"=>"no", "bgcolor"=>"#ffffff"));
$nataskey = 'qw8J';  #xor_encrypt($ciphertext, $plaintext); Found it with the XOR function but then had to hard-code it cause it's a repeating key.

echo("XORing the ciphertext with the plaintext gives us the key: $nataskey\n");

$solution = base64_encode(xor_encrypt(json_encode(array( "showpassword"=>"yes", "bgcolor"=>"#ffffff")), $nataskey));
echo("Change cookie to $solution to advance to the next level.\n");

function xor_encrypt($in, $key) {
    $text = $in;
    $outText = '';

    // Iterate through each character
    for($i=0;$i<strlen($text);$i++) {
    $outText .= $text[$i] ^ $key[$i % strlen($key)];
    }

    return $outText;
}


?>
